<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Meta AR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<style>
body { margin: 0; overflow: hidden; }
#chat {
    position: fixed; bottom: 0; width: 100%;
    background: rgba(0,0,0,.6); color: #fff;
}
</style>
</head>

<body>
<a-scene embedded arjs>
    <a-entity camera gps-camera rotation-reader></a-entity>
</a-scene>

<div id="chat">
    <input id="msg" placeholder="Chat local..." />
</div>

<script>
const socket = io();
let myName = "User" + Math.floor(Math.random()*999);

navigator.geolocation.watchPosition(pos => {
    socket.emit("join", {
        name: myName,
        lat: pos.coords.latitude,
        lng: pos.coords.longitude
    });
}, null, { enableHighAccuracy: true });

document.getElementById("msg").addEventListener("keydown", e => {
    if (e.key === "Enter") {
        socket.emit("chat", e.target.value);
        e.target.value = "";
    }
});

socket.on("chat", data => {
    console.log(`${data.name}: ${data.text}`);
});
</script>
</body>
</html>
